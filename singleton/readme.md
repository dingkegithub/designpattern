


<h2 id='1'> 1、单例模式 </h2>

一个类只能创建一个对象

<h4 id='1.1'> 1.1、如何构造单例 </h4>

> 创建单例考虑的因素


- 构造函数私有化，不允许外界调用构造函数构造对象

- 线程安全，加锁防止被多次创建

- 是否延迟加载创建

- 获取单例对象的性能如何？


<h4 id='1.2'> 1.2、饿汉式 </h4>

加载类的时候对象就已经实例化, 不支持延迟加载，但这并不是它的缺点，

因为对于初始化延迟比较大的，应当在系统启动时就应该初始化，便于

fast-fail，若是按照懒汉式，用到才加载，很可能加载时间长，影响

用户体验。另外若失败，查问题比较费劲，所以对于加载时间较长的

应该用饿汉式，失败的问题在启动时就修复，别等到运行一段时间再

修复

<h4 id='1.3'> 1.3、懒汉式 </h4>

用到才实例化

<h4 id='1.4'> 1.4、场景 </h4>

从业务角度讲，进程只需要一份数据

- 配置信息

- 数据库连接池

<h2 id='2'> 2、单例模式有哪些问题 </h2>

- 扩展性不友好

假设单例管理数据库连接池，其中有慢查询和快查询，此时向通过两个连接池来管理，一个管理慢查询，一个

分配给快查询，降低彼此影响，此时单例就无法做到

- 单例对代码的可测试性不友好

比如单例中用的是mysql，此时我们测试时，用mock方式，此时就很难测试了，根本无法用mock来替换mysql，

另外一些单例持有的变量，若可更改，那么多个测试用例用到了单例，此时状态不好预估，也就无法断言测试

的正确性

- 单例不支持外部传入构造参数

这点我想都有感觉，想把一个类作为单例，但是还需要一些参数的传入，此时单例得需要类似多加个公共

方法用来更新参数,虽然能解决问题，但是很蹩脚.

或者还有有一种解决方法，单例依赖另外一个类，这个类外部可以访问，单例使用这个类的参数，但是仍然

很蹩脚


<h2 id='3'> 3、单例模式延伸 </h2>

<h4 id='3.1'> 3.1、单例模式作用范围 </h4>

进程级别

> 如何实现线程级别的单例

用map来存储，线程id 为键，value 为单例对象

> 进程间的单例如何实现

将单例序列化存储到共享存储的地方，然后共享存储区加锁，用时加锁并反序列化，用完存回去并释放锁

> 分布式单例

分布式锁实现


<h4 id='3.2'> 3.2、多例模式如何实现 </h4>

多例场景刚才说的快慢查询，在类中设置一个map，然后连续初始化2~3个存入，然后随机获取或者按照不同

的名字获取，就是说同一个名字只有一个实例
